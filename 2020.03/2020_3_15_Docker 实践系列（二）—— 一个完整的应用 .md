在上一篇中，介绍记录了一个简单的 demo，在实际的开发中肯定比这个要复杂。

在本篇中，将结合实际的开发环境，记录一个更加完整的 Docker 例子。

系统环境：Flask + MySQL + Redis

本来的计划是用 docker-compose 一把梭，完成整个系统的部署。

但是在实际过程中，数据库的构建总是有问题，而 Flask 构建又太费时间（需要安装很多东西），所以使用了分步构建的策略。

就是先构建 Flask，然后在 docker-compose.yml 中引用构建好的镜像

```
FROM python:3.7.5
ADD . /code
WORKDIR /code
RUN apt-get update && apt-get install -y libsasl2-dev \
libldap2-dev \
libssl-dev
ENV FLASK_APP master_key.py
ENV FLASK_ENV production
RUN pip install -r requirements.txt
CMD flask run --host=0.0.0.0
EXPOSE 5000
```
```
MYSQL_DATABASE=my_flask_app
MYSQL_USER=my_flask_app
MYSQL_PASSWORD=my_flask_app
MYSQL_ROOT_PASSWORD=my_flask_app
```

```
# 数据库初始化
CREATE DATABASE IF NOT EXISTS master_key DEFAULT CHARSET utf8 COLLATE utf8_general_ci;
```


```
version: '3'
services:
    web:
        networks:
            - app-network
        image: my_flask_app
        build: .
        ports:
            - "8888:5000"
        volumes:
            - .:/code
        depends_on:
            - mysql
            - redis
    redis:
        image: redis
        networks:
            - app-network
    mysql:
        image: mysql:5.7.28
        #        restart: always
        env_file:
            - docker.env
        ports:
            - "4000:3306"
        volumes:
            - ./mysql_data:/var/lib/mysql
            - ./mysql_config:/docker-entrypoint-initdb.d
        networks:
            - app-network

networks:
  app-network:
    driver: bridge
```


